<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SineEncoder | Cyber Obfuscator</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- Configuration -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        cyber: {
                            bg: '#05050A',
                            panel: '#0F111A',
                            border: '#1E293B',
                            blue: '#3B82F6',
                            glow: '#60A5FA',
                            text: '#94A3B8'
                        }
                    },
                    animation: {
                        'blob': 'blob 7s infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .glass-panel {
                @apply bg-[#0F111A]/80 backdrop-blur-xl border border-slate-700/50 shadow-xl;
            }
            .glass-input {
                @apply bg-[#05050A]/60 border border-slate-800 focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/50 outline-none transition-all duration-300;
            }
            .cyber-btn {
                @apply relative overflow-hidden transition-all duration-300 active:scale-95;
            }
            .cyber-btn::after {
                content: '';
                @apply absolute inset-0 bg-white/10 opacity-0 transition-opacity duration-300;
            }
            .cyber-btn:hover::after {
                @apply opacity-100;
            }
            
            /* Custom Scrollbar */
            ::-webkit-scrollbar {
                width: 8px;
                height: 8px;
            }
            ::-webkit-scrollbar-track {
                @apply bg-[#05050A];
            }
            ::-webkit-scrollbar-thumb {
                @apply bg-slate-700 rounded-full hover:bg-slate-600;
            }
        }

        body {
            background-color: #05050A;
            background-image: 
                radial-gradient(at 0% 0%, rgba(59, 130, 246, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(147, 51, 234, 0.1) 0px, transparent 50%);
            min-height: 100vh;
        }

        /* Dropdown Animation */
        .dropdown-enter {
            animation: slideDown 0.2s ease-out forwards;
            transform-origin: top;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: scaleY(0.9); }
            to { opacity: 1; transform: scaleY(1); }
        }
    </style>
</head>
<body class="text-slate-300 selection:bg-blue-500/30">

    <!-- Background Blobs -->
    <div class="fixed inset-0 pointer-events-none overflow-hidden -z-10">
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-blue-500/10 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"></div>
        <div class="absolute top-0 right-1/4 w-96 h-96 bg-purple-500/10 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 z-50 transform transition-all duration-300 translate-y-24 opacity-0">
        <div class="glass-panel px-4 py-3 rounded-lg flex items-center gap-3 border-l-4 border-l-blue-500 shadow-2xl">
            <i data-lucide="check-circle" class="w-5 h-5 text-blue-400"></i>
            <span id="toast-msg" class="font-medium text-sm text-white">Action successful</span>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="sticky top-0 z-40 w-full border-b border-white/5 bg-[#05050A]/80 backdrop-blur-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Left -->
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center shadow-lg shadow-blue-500/20">
                        <i data-lucide="code-2" class="w-5 h-5 text-white"></i>
                    </div>
                    <span class="font-bold text-lg tracking-tight text-white">Sine<span class="text-blue-400">Encoder</span></span>
                    
                    <div class="hidden md:flex items-center gap-2 ml-4 px-2 py-1 rounded-full bg-slate-800/50 border border-slate-700/50">
                        <div class="w-1.5 h-1.5 rounded-full bg-blue-400 shadow-[0_0_8px_rgba(96,165,250,0.8)]"></div>
                        <span class="text-xs font-medium text-blue-200">Cyber</span>
                    </div>
                </div>

                <!-- Right -->
                <div class="flex items-center gap-4">
                    <button class="p-2 text-slate-400 hover:text-white transition-colors"><i data-lucide="book" class="w-5 h-5"></i></button>
                    <button class="p-2 text-slate-400 hover:text-white transition-colors"><i data-lucide="share-2" class="w-5 h-5"></i></button>
                    <button class="p-2 text-slate-400 hover:text-white transition-colors"><i data-lucide="settings" class="w-5 h-5"></i></button>
                    <span class="hidden sm:inline-block px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-500/10 text-blue-400 border border-blue-500/20">v3.0.0</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-5xl mx-auto px-4 py-8 sm:px-6">
        
        <!-- Control Pills -->
        <div class="flex justify-center mb-8">
            <div class="inline-flex p-1 rounded-xl bg-slate-900/80 border border-slate-800 backdrop-blur-sm">
                <button class="px-4 md:px-6 py-2 rounded-lg text-xs md:text-sm font-medium text-slate-400 hover:text-white transition-colors">Encode Mode</button>
                <button class="px-4 md:px-6 py-2 rounded-lg text-xs md:text-sm font-medium text-slate-400 hover:text-white transition-colors">Decode Mode</button>
                <button class="px-4 md:px-6 py-2 rounded-lg text-xs md:text-sm font-medium text-slate-400 hover:text-white transition-colors">Auto Mode</button>
                <button class="px-4 md:px-6 py-2 rounded-lg text-xs md:text-sm font-medium bg-blue-600 text-white shadow-lg shadow-blue-500/25">Obfuscate</button>
            </div>
        </div>

        <!-- Main Interface Card -->
        <div class="glass-panel rounded-2xl p-6 md:p-8 animate-fade-in relative z-10">
            
            <!-- Selectors Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                
                <!-- Language Dropdown -->
                <div class="relative group z-50">
                    <label class="block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Language</label>
                    <button id="lang-btn" class="w-full text-left glass-input rounded-lg px-4 py-3 flex items-center justify-between group-hover:border-slate-700">
                        <span id="selected-lang" class="font-medium text-slate-200">Luau</span>
                        <i data-lucide="chevron-down" class="w-4 h-4 text-slate-500 transition-transform duration-200" id="lang-chevron"></i>
                    </button>
                    
                    <!-- Dropdown List -->
                    <div id="lang-menu" class="hidden absolute top-full left-0 right-0 mt-2 glass-panel rounded-xl border border-slate-700 shadow-2xl overflow-hidden dropdown-enter">
                        <div class="max-h-60 overflow-y-auto py-1" id="lang-options">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Level Dropdown -->
                <div class="relative group z-40">
                    <label class="block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Obfuscation Level</label>
                    <button id="level-btn" class="w-full text-left glass-input rounded-lg px-4 py-3 flex items-center justify-between group-hover:border-slate-700">
                        <span id="selected-level" class="font-medium text-slate-200">Level 4 - Armored (PRNG + Junk Ops)</span>
                        <i data-lucide="chevron-down" class="w-4 h-4 text-slate-500 transition-transform duration-200" id="level-chevron"></i>
                    </button>
                    
                    <!-- Dropdown List -->
                    <div id="level-menu" class="hidden absolute top-full left-0 right-0 mt-2 glass-panel rounded-xl border border-slate-700 shadow-2xl overflow-hidden dropdown-enter">
                        <div class="py-1" id="level-options">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Editor Section -->
            <div class="mb-6 z-0">
                <div class="flex items-center justify-between mb-2">
                    <h3 class="text-sm font-medium text-slate-300 flex items-center gap-2">
                        <i data-lucide="file-code" class="w-4 h-4 text-blue-400"></i>
                        Source Code to Obfuscate
                    </h3>
                    <div class="flex items-center gap-2">
                        <input type="file" id="file-upload" class="hidden">
                        <button onclick="document.getElementById('file-upload').click()" class="text-xs flex items-center gap-1 px-3 py-1.5 rounded-md bg-slate-800 hover:bg-slate-700 text-slate-300 transition-colors border border-slate-700">
                            <i data-lucide="upload" class="w-3 h-3"></i> Upload File
                        </button>
                        <button id="clear-btn" class="text-xs flex items-center gap-1 px-3 py-1.5 rounded-md bg-slate-800 hover:bg-red-500/10 hover:text-red-400 text-slate-300 transition-colors border border-slate-700 hover:border-red-500/30">
                            Clear
                        </button>
                    </div>
                </div>
                
                <div class="relative group">
                    <textarea id="source-input" spellcheck="false" class="w-full h-64 glass-input rounded-xl p-4 font-mono text-sm text-slate-300 placeholder-slate-600 resize-y focus:shadow-[0_0_15px_rgba(59,130,246,0.1)]" placeholder="Paste your code here..."></textarea>
                    
                    <!-- Stats Overlay -->
                    <div class="absolute bottom-3 right-4 px-3 py-1 rounded-md bg-slate-900/90 border border-slate-800 text-[10px] font-mono text-slate-500 pointer-events-none">
                        <span id="stat-words">0</span> words | <span id="stat-lines">0</span> lines | <span id="stat-bytes">0</span> bytes
                    </div>
                </div>
            </div>

            <!-- Action Button -->
            <button id="obfuscate-btn" class="w-full cyber-btn py-4 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold text-lg shadow-[0_0_20px_rgba(37,99,235,0.3)] hover:shadow-[0_0_30px_rgba(37,99,235,0.5)] flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                <i data-lucide="lock" class="w-5 h-5"></i>
                <span>Obfuscate</span>
            </button>

            <!-- Info Box -->
            <div class="mt-6 p-4 rounded-xl bg-blue-500/5 border border-blue-500/10">
                <h4 class="text-xs font-bold text-blue-400 uppercase tracking-wide mb-2">Executor Scripts</h4>
                <ul class="space-y-1.5 text-xs text-slate-400 leading-relaxed">
                    <li class="flex items-start gap-2">
                        <span class="mt-1.5 w-1 h-1 rounded-full bg-slate-500"></span>
                        <span>Level 3 uses randomized variable renaming and junk comments.</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="mt-1.5 w-1 h-1 rounded-full bg-green-500 shadow-[0_0_5px_rgba(34,197,94,0.6)]"></span>
                        <span class="text-slate-300"> <span class="text-green-400 font-semibold">Level 4</span> adds PRNG key generation (no key table), junk opcodes to waste reverser time, and hidden loadstring via getenv.</span>
                    </li>
                </ul>
            </div>

            <!-- Output Section -->
            <div class="mt-8 border-t border-slate-800 pt-6">
                <div class="flex items-center justify-between mb-2">
                    <h3 class="text-sm font-medium text-slate-300 flex items-center gap-2">
                        <i data-lucide="shield-check" class="w-4 h-4 text-green-400"></i>
                        Obfuscated Output
                    </h3>
                    <button id="copy-btn" class="text-xs flex items-center gap-1 px-3 py-1.5 rounded-md bg-blue-500/10 text-blue-400 border border-blue-500/20 hover:bg-blue-500/20 transition-all">
                        <i data-lucide="copy" class="w-3 h-3"></i> Copy
                    </button>
                </div>
                <textarea id="output-box" readonly spellcheck="false" class="w-full h-48 glass-input rounded-xl p-4 font-mono text-xs md:text-sm text-green-400/90 bg-[#020204] resize-y mb-2 border-slate-800" placeholder="Output will appear here..."></textarea>
                
                <p class="text-center text-[10px] text-slate-600 mt-2">
                    <i data-lucide="alert-triangle" class="w-3 h-3 inline mr-1 align-text-bottom"></i>
                    Obfuscation is not perfect security â€” treat it as a deterrent.
                </p>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="max-w-5xl mx-auto px-6 py-8 text-center border-t border-slate-800/50 mt-8">
        <p class="text-slate-600 text-sm">&copy; 2024 SineEncoder v3.0.0. All rights reserved.</p>
    </footer>

    <!-- LOGIC SCRIPT -->
    <script>
        // --- 1. CONFIGURATION & STATE ---
        const languages = [
            "Luau", 
            "Python 3 (basic)", 
            "JavaScript (basic) (Node/Browser)", 
            "C++ (basic) (Windows/Linux)", 
            "Windows Batch (basic) (.bat)", 
            "PowerShell (basic) (.ps1)", 
            "C# (basic) (.cs)", 
            "HTML (basic) (Web Page)", 
            "PHP (basic) (Web Server)"
        ];

        const levels = [
            { id: 1, name: "Level 1 - Byte Array" },
            { id: 2, name: "Level 2 - XOR Encrypted" },
            { id: 3, name: "Level 3 - Disguised (AI-Resistant)" },
            { id: 4, name: "Level 4 - Armored (PRNG + Junk Ops)" }
        ];

        let state = {
            lang: languages[0],
            level: 4
        };

        // --- 2. OBFUSCATION LOGIC ---
        const Utils = {
            // Helper to get random variable name
            randomVar: (len = 6) => {
                const chars = '_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
                let res = chars[Math.floor(Math.random() * chars.length)];
                for(let i=1; i<len; i++) res += chars[Math.floor(Math.random() * chars.length)];
                return res;
            },
            // Helper to get array of ASCII codes
            strToBytes: (str) => str.split('').map(c => c.charCodeAt(0)),
            // Helper to XOR encrypt
            xor: (str, key) => str.split('').map(c => c.charCodeAt(0) ^ key),
            // Helper to generate junk comments
            junkComment: (lang) => {
                const junks = ["Optimization routine", "Memory alloc", "Check integrity", "Init core", "Load dependencies"];
                const txt = junks[Math.floor(Math.random() * junks.length)];
                if(lang === 'bat') return `:: ${txt}`;
                if(lang === 'py' || lang === 'ps1') return `# ${txt}`;
                if(lang === 'html') return `<!-- ${txt} -->`;
                return `// ${txt}`;
            },
            // Get random math junk
            junkMath: (v) => {
                const ops = [`${v}=${v}+1`, `${v}=${v}*1`, `${v}=Math.abs(${v})`];
                return ops[Math.floor(Math.random() * ops.length)];
            }
        };

        const Obfuscators = {
            "Luau": (code, level) => {
                // Luau / Lua: Uses string.char and loadstring/getfenv
                const v1 = Utils.randomVar(5);
                const v2 = Utils.randomVar(5);
                
                if(level <= 2) {
                    const bytes = Utils.strToBytes(code);
                    return `-- SineEncoder Level ${level}
local ${v1} = {${bytes.join(',')}}
local ${v2} = ""
for i,v in ipairs(${v1}) do ${v2} = ${v2} .. string.char(v) end
loadstring(${v2})()`;
                }
                
                // Level 3 & 4: XOR + Junk
                const key = Math.floor(Math.random() * 255);
                const enc = Utils.xor(code, key);
                const junk1 = Utils.randomVar();
                
                return `--[[ SineEncoder Protected (Level ${level}) ]]
local ${v1} = {${enc.join(',')}}
local ${v2} = ""
-- ${Utils.junkComment('lua')}
local function ${junk1}(k) return bit32.bxor(k, ${key}) end
for _,b in ipairs(${v1}) do
    ${v2} = ${v2} .. string.char(${junk1}(b))
end
getfenv()[string.reverse("gnirtsdaol")](${v2})()`;
            },

            "Python 3 (basic)": (code, level) => {
                const v1 = Utils.randomVar();
                const v2 = Utils.randomVar();
                
                if (level <= 2) {
                    const b64 = btoa(code);
                    return `# SineEncoder Protected
import base64
${v1} = "${b64}"
exec(base64.b64decode(${v1}))`;
                }

                // Level 4: Zlib + B64 + Reverse
                // Note: In a browser we can't easily zlib compress without a lib, 
                // so we will simulate complex python packing
                const b64 = btoa(code.split('').reverse().join(''));
                
                return `# SineEncoder Level 4
import base64, sys
${Utils.junkComment('py')}
${v1} = "${b64}"
${v2} = lambda x: x[::-1]
exec(base64.b64decode(${v2}(${v1})).decode('utf-8'))`;
            },

            "JavaScript (basic) (Node/Browser)": (code, level) => {
                const v1 = Utils.randomVar();
                const v2 = Utils.randomVar();
                const key = Math.floor(Math.random() * 100);

                if (level >= 3) {
                    const enc = Utils.xor(code, key);
                    return `/* SineEncoder v3 */
(function(){
    var ${v1} = [${enc.join(',')}];
    var ${v2} = "";
    ${v1}.forEach(function(b){ ${v2} += String.fromCharCode(b ^ ${key}); });
    // ${Utils.junkComment('js')}
    (new Function(${v2}))();
})();`;
                }
                
                // Simple eval wrapper
                const hex = code.split('').map(c => '\\x' + c.charCodeAt(0).toString(16).padStart(2,'0')).join('');
                return `eval("${hex}")`;
            },

            "C++ (basic) (Windows/Linux)": (code, level) => {
                // C++ cannot just 'run' string source. We generate a Loader.
                const bytes = Utils.strToBytes(code);
                const varName = Utils.randomVar();
                
                return `// SineEncoder C++ Loader
#include <iostream>
#include <string>
#include <vector>

int main() {
    // Original source is hidden in this array
    unsigned char ${varName}[] = { ${bytes.join(', ')}, 0 };
    
    std::string source_code = (char*)${varName};
    
    // ${Utils.junkComment('cpp')}
    std::cout << "--- Decoded Source ---" << std::endl;
    std::cout << source_code << std::endl;
    
    // To execute, you would write this to a file and system() call compiler
    return 0;
}`;
            },

            "Windows Batch (basic) (.bat)": (code, level) => {
                // Batch obfuscation via variable expansion
                const map = {
                    'a': '%p:~0,1%', 'b': '%p:~1,1%', 'c': '%p:~2,1%', 
                    'd': '%p:~3,1%', 'e': '%p:~4,1%', ' ': '%p:~26,1%'
                };
                // Simplified conceptual demo for Batch
                let res = "@echo off\n";
                res += `set "p=abcdefghijklmnopqrstuvwxyz 1234567890"\n`;
                res += `:: ${Utils.junkComment('bat')}\n`;
                res += "cls\n";
                // Real batch obfuscation is complex, we'll just wrap it in a tmp file runner
                const b64 = btoa(code);
                res += `echo ${b64} > tmp.b64\n`;
                res += `certutil -decode tmp.b64 tmp.bat >nul\n`;
                res += `call tmp.bat\n`;
                res += `del tmp.b64 tmp.bat`;
                return res;
            },

            "PowerShell (basic) (.ps1)": (code, level) => {
                const b64 = btoa(code);
                const v1 = Utils.randomVar(4);
                return `# SineEncoder PowerShell
$${v1} = "${b64}"
$d = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($${v1}))
# ${Utils.junkComment('ps1')}
Invoke-Expression $d`;
            },

            "C# (basic) (.cs)": (code, level) => {
                const b64 = btoa(code);
                const ns = Utils.randomVar(8);
                const cls = Utils.randomVar(6);
                
                return `using System;
using System.Text;

namespace ${ns} {
    class ${cls} {
        static void Main(string[] args) {
            string payload = "${b64}";
            byte[] data = Convert.FromBase64String(payload);
            string decoded = Encoding.UTF8.GetString(data);
            
            // ${Utils.junkComment('cpp')}
            Console.WriteLine("Executing logic...");
            // Dynamic execution requires Roslyn, here we just print
            Console.WriteLine(decoded);
        }
    }
}`;
            },

            "HTML (basic) (Web Page)": (code, level) => {
                // Obfuscate the JS inside HTML or the HTML itself via document.write
                const b64 = btoa(code);
                return `<!DOCTYPE html>
<html>
<body>
<script>
// SineEncoder HTML Wrapper
var _0x = "${b64}";
var _0y = atob(_0x);
document.open();
document.write(_0y);
document.close();
<\/script>
</body>
</html>`;
            },

            "PHP (basic) (Web Server)": (code, level) => {
                const b64 = btoa(code);
                const v1 = Utils.randomVar();
                return `<?php
/* SineEncoder PHP */
$${v1} = "${b64}";
eval(base64_decode($${v1}));
?>`;
            }
        };

        // --- 3. UI INTERACTION ---
        
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            // Populate Dropdowns
            const langMenu = document.getElementById('lang-options');
            languages.forEach(lang => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left px-4 py-2 text-sm text-slate-400 hover:text-white hover:bg-slate-800 transition-colors flex items-center justify-between";
                btn.innerHTML = `<span>${lang}</span>`;
                btn.onclick = () => selectLang(lang);
                langMenu.appendChild(btn);
            });

            const levelMenu = document.getElementById('level-options');
            levels.forEach(lvl => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left px-4 py-2 text-sm text-slate-400 hover:text-white hover:bg-slate-800 transition-colors flex items-center justify-between";
                btn.innerHTML = `<span class="${lvl.id===4 ? 'text-green-400 font-medium':''}">${lvl.name}</span>`;
                btn.onclick = () => selectLevel(lvl.id);
                levelMenu.appendChild(btn);
            });

            // State Handlers
            function selectLang(lang) {
                state.lang = lang;
                document.getElementById('selected-lang').textContent = lang;
                toggleDropdown('lang-menu', false);
            }

            function selectLevel(lvlId) {
                state.level = lvlId;
                const lvlObj = levels.find(l => l.id === lvlId);
                const el = document.getElementById('selected-level');
                el.textContent = lvlObj.name;
                
                // Color highlight for level 4
                if(lvlId === 4) el.classList.add('text-green-400');
                else el.classList.remove('text-green-400');
                
                toggleDropdown('level-menu', false);
            }

            // Dropdown Toggles
            function toggleDropdown(id, forceState) {
                const el = document.getElementById(id);
                const isOpen = !el.classList.contains('hidden');
                const shouldOpen = forceState !== undefined ? forceState : !isOpen;
                
                if (shouldOpen) el.classList.remove('hidden');
                else el.classList.add('hidden');
            }

            document.getElementById('lang-btn').onclick = (e) => {
                e.stopPropagation();
                toggleDropdown('lang-menu');
                toggleDropdown('level-menu', false);
            };

            document.getElementById('level-btn').onclick = (e) => {
                e.stopPropagation();
                toggleDropdown('level-menu');
                toggleDropdown('lang-menu', false);
            };

            // Close dropdowns on click outside
            document.onclick = () => {
                toggleDropdown('lang-menu', false);
                toggleDropdown('level-menu', false);
            };

            // Input Stats
            const input = document.getElementById('source-input');
            input.addEventListener('input', () => {
                const txt = input.value;
                document.getElementById('stat-bytes').textContent = new Blob([txt]).size;
                document.getElementById('stat-words').textContent = txt.trim() === '' ? 0 : txt.trim().split(/\s+/).length;
                document.getElementById('stat-lines').textContent = txt.trim() === '' ? 0 : txt.split('\n').length;
                
                document.getElementById('obfuscate-btn').disabled = txt.trim() === '';
            });

            // File Upload
            document.getElementById('file-upload').onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    input.value = ev.target.result;
                    input.dispatchEvent(new Event('input'));
                    showToast("File loaded successfully");
                };
                reader.readAsText(file);
            };

            // Clear
            document.getElementById('clear-btn').onclick = () => {
                input.value = '';
                input.dispatchEvent(new Event('input'));
                document.getElementById('output-box').value = '';
            };

            // Copy
            document.getElementById('copy-btn').onclick = () => {
                const out = document.getElementById('output-box');
                if(!out.value) return;
                out.select();
                navigator.clipboard.writeText(out.value).then(() => showToast("Copied to clipboard!"));
            };

            // Obfuscate Action
            document.getElementById('obfuscate-btn').onclick = () => {
                const code = input.value;
                if (!code.trim()) return;

                const btn = document.getElementById('obfuscate-btn');
                const originalText = btn.innerHTML;
                
                // Loading State
                btn.disabled = true;
                btn.innerHTML = `<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i> Processing...`;
                lucide.createIcons();

                setTimeout(() => {
                    try {
                        const obfuscator = Obfuscators[state.lang];
                        if (obfuscator) {
                            const result = obfuscator(code, state.level);
                            document.getElementById('output-box').value = result;
                            showToast("Obfuscation complete!");
                        } else {
                            document.getElementById('output-box').value = "// Error: Language obfuscator not found.";
                        }
                    } catch (err) {
                        console.error(err);
                        document.getElementById('output-box').value = "// Error during obfuscation: " + err.message;
                    }
                    
                    // Reset Button
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                    lucide.createIcons();
                }, 600); // Fake delay for "processing" feel
            };

            // Toast Helper
            function showToast(msg) {
                const t = document.getElementById('toast');
                document.getElementById('toast-msg').textContent = msg;
                t.classList.remove('translate-y-24', 'opacity-0');
                setTimeout(() => {
                    t.classList.add('translate-y-24', 'opacity-0');
                }, 3000);
            }
        });
    </script>
</body>
</html>
